<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bot SOC Dashboard Simulación</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<style>
body { background-color: #F8FAFC; color: #1E293B; }
.glass { background: rgba(255,255,255,0.85); backdrop-filter: blur(12px); }
.tag { padding: 0.15rem 0.5rem; border-radius: 9999px; font-size: 0.7rem; font-weight: 600; cursor: default; }
.tab-active { border-bottom: 3px solid #3B82F6; font-weight: 600; }
.scrollbar-thin::-webkit-scrollbar { width: 6px; }
.scrollbar-thin::-webkit-scrollbar-thumb { background-color: rgba(59,130,246,0.4); border-radius: 3px; }
</style>
</head>
<body class="antialiased">

<div class="min-h-screen flex flex-col md:flex-row p-4 gap-4">

  <!-- Panel Chat -->
  <div class="w-full md:w-2/3 glass rounded-2xl p-6 shadow-lg border border-gray-200 flex flex-col max-h-[90vh]">
    <header class="flex items-center justify-between mb-4">
      <h1 class="text-2xl font-semibold text-gray-800">Bot</h1>
      <i class='bx bx-robot text-3xl text-blue-500'></i>
    </header>

    <div id="chatBox" class="flex-1 overflow-y-auto scrollbar-thin p-4 rounded-xl space-y-3 bg-white">
      <div class="bg-blue-100 p-3 rounded-xl max-w-[75%] shadow-sm text-gray-800">¡Hola! Pregunta sobre incidentes, riesgos o controles y te daré respuesta con respaldo de documentos y % confianza.</div>
    </div>

    <div class="mt-4 flex gap-2">
      <input id="question" type="text" placeholder="Ej: Fuga de datos de clientes" class="flex-1 px-4 py-3 rounded-xl bg-gray-100 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400"/>
      <button id="askBtn" class="px-4 py-3 rounded-xl bg-blue-500 text-white font-semibold hover:scale-[1.02] transition">Consultar</button>
    </div>
  </div>

  <!-- Panel derecho con tabs -->
  <div class="w-full md:w-1/3 glass rounded-2xl p-4 shadow-lg border border-gray-200 max-h-[90vh] flex flex-col">
    
    <!-- Tabs -->
    <div class="flex mb-4 border-b border-gray-300">
      <button class="flex-1 py-2 text-center tab tab-active" data-tab="fragments"><i class='bx bx-info-circle mr-1'></i> Fragmentos</button>
      <button class="flex-1 py-2 text-center tab" data-tab="history"><i class='bx bx-history mr-1'></i> Historial</button>
      <button class="flex-1 py-2 text-center tab" data-tab="pdfs"><i class='bx bx-file-blank mr-1'></i> Documentos</button>
    </div>

    <!-- Tab content -->
    <div id="tabContent" class="flex-1 overflow-y-auto scrollbar-thin">

      <!-- Fragmentos -->
      <div class="tab-panel" id="fragments">
        <div id="fragList" class="space-y-3"></div>
      </div>

      <!-- Historial -->
      <div class="tab-panel hidden" id="historyTab">
        <div id="history" class="space-y-3"></div>
      </div>

      <!-- PDFs -->
      <div class="tab-panel hidden" id="pdfs">
        <iframe src="https://example.com/documento.pdf" class="w-full h-[400px] rounded-lg border border-gray-300"></iframe>
        <p class="text-sm text-gray-500 mt-2">PDF de ejemplo incrustado.</p>
      </div>

    </div>

  </div>

</div>

<script>
const askBtn = document.getElementById('askBtn');
const questionInput = document.getElementById('question');
const chatBox = document.getElementById('chatBox');
const fragList = document.getElementById('fragList');
const historyEl = document.getElementById('history');

const MOCK_FRAGMENTS = [
  { source: "Millicom_Policies.pdf", page: 12, snippet: "Activar plan de respuesta ante incidentes y notificar a Compliance.", embScore: 0.89, tag:"Incidente" },
  { source: "ISO27001.pdf", page: "A.18.1.3", snippet: "Documentar procedimientos de gestión y comunicación de incidentes.", embScore: 0.84, tag:"Control" },
  { source: "NIST_CSF.pdf", page: "RS-1", snippet: "Coordinar la comunicación durante y después de un incidente.", embScore: 0.78, tag:"Política" }
];

const HISTORY = [];

function getPriority(score){
  if(score>=85) return {text:'Alta', color:'bg-red-500'};
  if(score>=65) return {text:'Media', color:'bg-yellow-400'};
  return {text:'Baja', color:'bg-green-400'};
}

function renderFragments(frags){
  fragList.innerHTML = "";
  frags.forEach(f=>{
    const prio = getPriority(f.embScore*100);
    const div = document.createElement('div');
    div.className = "p-3 bg-gray-50 rounded-lg border border-gray-200 text-sm hover:shadow-md transition relative";
    const color = f.tag==='Incidente'?'bg-red-500':f.tag==='Política'?'bg-blue-400':'bg-indigo-400';
    div.innerHTML = `
      <div class="flex items-center justify-between mb-1">
        <div class="font-semibold text-gray-800">${f.source} • p.${f.page}</div>
        <span class="tag ${color}">${f.tag}</span>
      </div>
      <div class="text-gray-700 mb-2">${f.snippet}</div>
      <div class="flex items-center justify-between text-xs text-gray-500">
        <span>Score: ${Math.round(f.embScore*100)}%</span>
        <div class="flex gap-2">
          <span class="tag ${prio.color}">${prio.text}</span>
          <button class="copyBtn text-gray-400 hover:text-gray-800"><i class='bx bx-copy'></i></button>
        </div>
      </div>
    `;
    fragList.appendChild(div);
    div.querySelector('.copyBtn').addEventListener('click',()=>navigator.clipboard.writeText(f.snippet));
  });
}

function renderHistory(){
  historyEl.innerHTML = "";
  HISTORY.slice(0,6).forEach(h=>{
    const prio = getPriority(h.conf);
    const div = document.createElement('div');
    div.className = "p-2 bg-gray-50 rounded flex items-center justify-between text-sm hover:shadow transition";
    div.innerHTML = `<div>${h.q}<br><span class="text-xs text-gray-500">${h.tag}</span></div><div class="flex items-center gap-2"><span class="font-semibold">${h.conf}%</span><span class="tag ${prio.color}">${prio.text}</span></div>`;
    historyEl.appendChild(div);
  });
}

// Simulación de respuesta con varias etiquetas automáticas
function simulateResponse(question){
  const frags = MOCK_FRAGMENTS.slice().sort((a,b)=>b.embScore-a.embScore).slice(0,3);
  const avgScore = Math.round((frags.reduce((s,f)=>s+f.embScore,0)/frags.length)*100);

  // Etiquetas automáticas tipo IA
  const autoTags = ['Incidente', 'Control', 'Riesgo', 'Política', 'Alta Prioridad'];
  const selectedTags = autoTags.slice(0,3); // selecciona 3 por ejemplo

  const recommendations = "Recomendación: Prioriza la contención rápida, notifica a Compliance, audita accesos y documenta evidencia. Evalúa criticidad y seguimiento.";

  const botDiv = document.createElement('div');
  botDiv.className = "bg-blue-100 p-3 rounded-xl max-w-[75%] shadow-sm text-gray-800";
  botDiv.innerHTML = `<strong>Confianza:</strong> ${avgScore}%<br>
  <div class="flex flex-wrap gap-1 my-1">${selectedTags.map(t=>`<span class="tag bg-blue-400">${t}</span>`).join('')}</div>
  <div>${recommendations}</div>`;
  chatBox.appendChild(botDiv);
  chatBox.scrollTop = chatBox.scrollHeight;

  HISTORY.unshift({q: question, tag: selectedTags.join(','), conf: avgScore});
  renderHistory();
  renderFragments(frags);
}

askBtn.addEventListener('click',()=>{
  const q = questionInput.value.trim();
  if(!q) return alert("Escribe tu pregunta.");
  const userDiv = document.createElement('div');
  userDiv.className = "bg-gray-100 p-3 rounded-xl max-w-[75%] ml-auto shadow text-gray-800";
  userDiv.textContent = q;
  chatBox.appendChild(userDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
  questionInput.value = '';
  simulateResponse(q);
});

// Tabs funcionales
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('tab-active'));
    btn.classList.add('tab-active');
    const tab = btn.getAttribute('data-tab');
    document.querySelectorAll('.tab-panel').forEach(p=>p.classList.add('hidden'));
    if(tab==='fragments') document.getElementById('fragments').classList.remove('hidden');
    if(tab==='history') document.getElementById('historyTab').classList.remove('hidden');
    if(tab==='pdfs') document.getElementById('pdfs').classList.remove('hidden');
  });
});
</script>

</body>
</html>
