<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard SOC Profesional</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<style>
body { background-color: #0A1F44; color: #ffffff; }
.scrollbar-thin::-webkit-scrollbar { width: 6px; }
.scrollbar-thin::-webkit-scrollbar-thumb { background-color: rgba(59,130,246,0.6); border-radius: 3px; }
.tag { padding: 0.15rem 0.5rem; border-radius: 9999px; font-size: 0.7rem; font-weight: 600; cursor: default; }
.tab-active { border-b-2 border-[#3B82F6] font-semibold; }
</style>
</head>
<body class="antialiased flex h-screen">

<!-- Sidebar -->
<div class="w-16 md:w-64 bg-[#0F2B66] flex flex-col p-4 space-y-6">
  <div class="flex items-center justify-center md:justify-start text-white text-xl font-bold mb-6">
    <i class='bx bx-robot text-2xl mr-2'></i> <span class="hidden md:inline">Bot SOC</span>
  </div>
  <nav class="flex flex-col space-y-3">
    <button class="flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-[#1E3A8A] transition tab tab-active" data-tab="chat"><i class='bx bx-chat'></i><span class="hidden md:inline">Chat</span></button>
    <button class="flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-[#1E3A8A] transition tab" data-tab="fragments"><i class='bx bx-info-circle'></i><span class="hidden md:inline">Fragmentos</span></button>
    <button class="flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-[#1E3A8A] transition tab" data-tab="history"><i class='bx bx-history'></i><span class="hidden md:inline">Historial</span></button>
    <button class="flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-[#1E3A8A] transition tab" data-tab="pdfs"><i class='bx bx-file-blank'></i><span class="hidden md:inline">Documentos</span></button>
  </nav>
</div>

<!-- Panel principal -->
<div class="flex-1 flex flex-col p-4 space-y-4 overflow-hidden">

  <!-- Chat Panel -->
  <div id="chat" class="tab-panel flex flex-col flex-1 rounded-2xl bg-[#1E3A8A] p-4 shadow-lg scrollbar-thin overflow-y-auto">
    <div id="chatBox" class="flex-1 overflow-y-auto space-y-3 scrollbar-thin">
      <div class="bg-[#3B82F6] p-3 rounded-xl max-w-[75%] text-white shadow-lg">¡Hola! Pregunta sobre políticas, incidentes o controles y te daré respuesta con respaldo de documentos y % confianza.</div>
    </div>
    <div class="mt-4 flex gap-2">
      <input id="question" type="text" placeholder="Ej: ¿Qué hacer ante fuga de datos?" class="flex-1 px-4 py-3 rounded-xl bg-[#0F2B66] text-white focus:outline-none focus:ring-2 focus:ring-[#3B82F6]"/>
      <button id="askBtn" class="px-4 py-3 rounded-xl bg-[#3B82F6] text-white font-semibold hover:scale-[1.02] transition">Consultar</button>
    </div>
  </div>

  <!-- Fragmentos Panel -->
  <div id="fragments" class="tab-panel hidden flex flex-col flex-1 overflow-y-auto space-y-3 scrollbar-thin p-2">
    <div id="fragList"></div>
  </div>

  <!-- Historial Panel -->
  <div id="history" class="tab-panel hidden flex flex-col flex-1 overflow-y-auto space-y-3 scrollbar-thin p-2">
  </div>

  <!-- PDF Panel -->
  <div id="pdfs" class="tab-panel hidden flex flex-col flex-1 overflow-y-auto p-2">
    <iframe src="https://example.com/documento.pdf" class="w-full h-full rounded-lg border border-white/20"></iframe>
  </div>

</div>

<script>
const askBtn = document.getElementById('askBtn');
const questionInput = document.getElementById('question');
const chatBox = document.getElementById('chatBox');
const fragList = document.getElementById('fragList');
const historyEl = document.getElementById('history');

const MOCK_FRAGMENTS = [
  { source: "Millicom_Policies.pdf", page: 12, snippet: "Activar plan de respuesta ante incidentes y notificar a Compliance.", embScore: 0.89, tag:"Incidente" },
  { source: "ISO27001.pdf", page: "A.18.1.3", snippet: "Documentar procedimientos de gestión y comunicación de incidentes.", embScore: 0.84, tag:"Control" },
  { source: "NIST_CSF.pdf", page: "RS-1", snippet: "Coordinar la comunicación durante y después de un incidente.", embScore: 0.78, tag:"Política" }
];

const HISTORY = [];

function getPriority(score){
  if(score>=85) return {text:'Alta', color:'bg-red-500'};
  if(score>=65) return {text:'Media', color:'bg-yellow-400'};
  return {text:'Baja', color:'bg-green-400'};
}

function renderFragments(frags){
  fragList.innerHTML = "";
  frags.forEach(f=>{
    const prio = getPriority(f.embScore*100);
    const div = document.createElement('div');
    div.className = "p-3 bg-[#0F2B66] rounded-lg border border-white/10 text-sm hover:shadow-lg hover:bg-[#1E3A8A] transition relative";
    const color = f.tag==='Incidente'?'bg-red-500':f.tag==='Política'?'bg-[#3B82F6]':'bg-indigo-400';
    div.innerHTML = `
      <div class="flex items-center justify-between mb-1">
        <div class="font-semibold text-white">${f.source} • p.${f.page}</div>
        <span class="tag ${color}">${f.tag}</span>
      </div>
      <div class="text-white mb-2">${f.snippet}</div>
      <div class="flex items-center justify-between text-xs text-[#E5E5E5]">
        <span>Score: ${Math.round(f.embScore*100)}%</span>
        <div class="flex gap-2">
          <span class="tag ${prio.color}">${prio.text}</span>
          <button class="copyBtn text-white/70 hover:text-white"><i class='bx bx-copy'></i></button>
        </div>
      </div>
    `;
    fragList.appendChild(div);
    div.querySelector('.copyBtn').addEventListener('click',()=>navigator.clipboard.writeText(f.snippet));
  });
}

function renderHistory(){
  historyEl.innerHTML = "";
  HISTORY.slice(0,6).forEach(h=>{
    const prio = getPriority(h.conf);
    const div = document.createElement('div');
    div.className = "p-2 bg-[#0F2B66] rounded flex items-center justify-between text-sm hover:shadow-md transition";
    div.innerHTML = `<div>${h.q}<br><span class="text-xs text-[#E5E5E5]">${h.tag}</span></div><div class="flex items-center gap-2"><span class="font-semibold">${h.conf}%</span><span class="tag ${prio.color}">${prio.text}</span></div>`;
    historyEl.appendChild(div);
  });
}

function simulateResponse(question){
  const frags = MOCK_FRAGMENTS.slice().sort((a,b)=>b.embScore-a.embScore).slice(0,3);
  const avgScore = Math.round((frags.reduce((s,f)=>s+f.embScore,0)/frags.length)*100);
  const respText = "Según documentos, ante una fuga de datos: activar plan, notificar a Compliance, contener fuga y documentar evidencia.";
  const botDiv = document.createElement('div');
  botDiv.className = "bg-[#3B82F6] p-3 rounded-xl max-w-[75%] shadow-lg";
  botDiv.innerHTML = `<strong>Confianza:</strong> ${avgScore}%<br>${respText}`;
  chatBox.appendChild(botDiv);
  chatBox.scrollTop = chatBox.scrollHeight;

  HISTORY.unshift({q: question, tag: "Incidente", conf: avgScore});
  renderHistory();
  renderFragments(frags);
}

askBtn.addEventListener('click',()=>{
  const q = questionInput.value.trim();
  if(!q) return alert("Escribe tu pregunta.");
  const userDiv = document.createElement('div');
  userDiv.className = "bg-[#0F2B66] p-3 rounded-xl max-w-[75%] ml-auto shadow-md";
  userDiv.textContent = q;
  chatBox.appendChild(userDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
  questionInput.value = '';
  simulateResponse(q);
});

// Tabs funcionales
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('tab-active'));
    btn.classList.add('tab-active');
    const tab = btn.getAttribute('data-tab');
    document.querySelectorAll('.tab-panel').forEach(p=>p.classList.add('hidden'));
    if(tab==='chat') document.getElementById('chat').classList.remove('hidden');
    if(tab==='fragments') document.getElementById('fragments').classList.remove('hidden');
    if(tab==='history') document.getElementById('history').classList.remove('hidden');
    if(tab==='pdfs') document.getElementById('pdfs').classList.remove('hidden');
  });
});
</script>

</body>
</html>
