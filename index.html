<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bot SOC Profesional</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<style>
body { background-color: #003366; color: #ffffff; }
.glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(8px); }
.tag { padding: 0.15rem 0.5rem; border-radius: 9999px; font-size: 0.7rem; font-weight: 600; }
pre.snippet { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; white-space: pre-wrap; word-break: break-word; }
.tab-active { border-bottom: 2px solid #0096D6; font-weight: 600; }
</style>
</head>
<body class="antialiased">

<div class="min-h-screen flex flex-col md:flex-row p-4 gap-4">

  <!-- Chat panel -->
  <div class="w-full md:w-2/3 glass rounded-2xl p-6 shadow-lg border border-white/10 flex flex-col max-h-[90vh]">
    <header class="flex items-center justify-between mb-4">
      <h1 class="text-2xl font-semibold text-white">Bot SOC</h1>
      <i class='bx bx-robot text-3xl text-[#0096D6]'></i>
    </header>

    <div id="chatBox" class="flex-1 overflow-y-auto bg-[#00264D] p-4 rounded-xl space-y-3">
      <div class="bg-[#0096D6] p-3 rounded-lg max-w-[75%] text-white">¡Hola! Pregunta sobre políticas, incidentes o controles y te daré respuesta con respaldo de documentos y % confianza.</div>
    </div>

    <div class="mt-4 flex gap-2">
      <input id="question" type="text" placeholder="Ej: ¿Qué hacer ante fuga de datos?" class="flex-1 px-4 py-3 rounded-xl bg-[#004080] text-white focus:outline-none focus:ring-2 focus:ring-[#0096D6]"/>
      <button id="askBtn" class="px-4 py-3 rounded-xl bg-[#0096D6] text-white font-semibold hover:scale-[1.02] transition">Consultar</button>
    </div>
  </div>

  <!-- Panel derecho: tabs -->
  <div class="w-full md:w-1/3 glass rounded-2xl p-4 shadow-lg border border-white/10 max-h-[90vh] flex flex-col">
    
    <!-- Tabs -->
    <div class="flex mb-4 border-b border-white/20">
      <button class="flex-1 py-2 text-center tab tab-active" data-tab="fragments"><i class='bx bx-info-circle mr-1'></i> Fragmentos</button>
      <button class="flex-1 py-2 text-center tab" data-tab="history"><i class='bx bx-history mr-1'></i> Historial</button>
      <button class="flex-1 py-2 text-center tab" data-tab="pdfs"><i class='bx bx-file-blank mr-1'></i> Documentos</button>
    </div>

    <!-- Tab content -->
    <div id="tabContent" class="flex-1 overflow-y-auto">

      <!-- Fragmentos -->
      <div class="tab-panel" id="fragments">
        <div id="fragList" class="space-y-3"></div>
      </div>

      <!-- Historial -->
      <div class="tab-panel hidden" id="historyTab">
        <div id="history" class="space-y-3"></div>
      </div>

      <!-- PDFs -->
      <div class="tab-panel hidden" id="pdfs">
        <iframe src="https://example.com/documento.pdf" class="w-full h-[400px] rounded-lg border border-white/20"></iframe>
        <p class="text-sm text-[#E5E5E5] mt-2">PDF de ejemplo incrustado.</p>
      </div>

    </div>

  </div>

</div>

<script>
const askBtn = document.getElementById('askBtn');
const questionInput = document.getElementById('question');
const chatBox = document.getElementById('chatBox');
const fragList = document.getElementById('fragList');
const historyEl = document.getElementById('history');

const MOCK_FRAGMENTS = [
  { source: "Millicom_Policies.pdf", page: 12, snippet: "Activar plan de respuesta ante incidentes y notificar a Compliance.", embScore: 0.89, tag:"Incidente" },
  { source: "ISO27001.pdf", page: "A.18.1.3", snippet: "Documentar procedimientos de gestión y comunicación de incidentes.", embScore: 0.84, tag:"Control" },
  { source: "NIST_CSF.pdf", page: "RS-1", snippet: "Coordinar la comunicación durante y después de un incidente.", embScore: 0.78, tag:"Política" }
];

const HISTORY = [];

function renderFragments(frags){
  fragList.innerHTML = "";
  frags.forEach(f=>{
    const div = document.createElement('div');
    div.className = "p-3 bg-[#004080] rounded-lg border border-white/10 text-sm";
    const color = f.tag==='Incidente'?'bg-red-600':f.tag==='Política'?'bg-[#0096D6]':'bg-indigo-500';
    div.innerHTML = `
      <div class="flex items-center justify-between mb-1">
        <div class="font-semibold text-white">${f.source} • p.${f.page}</div>
        <span class="tag ${color}">${f.tag}</span>
      </div>
      <div class="text-white">${f.snippet}</div>
      <div class="text-xs text-[#E5E5E5] mt-1">Score: ${Math.round(f.embScore*100)}%</div>
    `;
    fragList.appendChild(div);
  });
}

function renderHistory(){
  historyEl.innerHTML = "";
  HISTORY.slice(0,6).forEach(h=>{
    const div = document.createElement('div');
    div.className = "p-2 bg-[#004080] rounded flex items-center justify-between text-sm";
    div.innerHTML = `<div>${h.q}<br><span class="text-xs text-[#E5E5E5]">${h.tag}</span></div><div class="font-semibold">${h.conf}%</div>`;
    historyEl.appendChild(div);
  });
}

function simulateResponse(question){
  const frags = MOCK_FRAGMENTS.slice().sort((a,b)=>b.embScore-a.embScore).slice(0,3);
  const avgScore = Math.round((frags.reduce((s,f)=>s+f.embScore,0)/frags.length)*100);
  const respText = "Según documentos, ante una fuga de datos: activar plan, notificar a Compliance, contener fuga y documentar evidencia.";
  const botDiv = document.createElement('div');
  botDiv.className = "bg-[#0096D6] p-3 rounded-lg max-w-[75%]";
  botDiv.innerHTML = `<strong>Confianza:</strong> ${avgScore}%<br>${respText}`;
  chatBox.appendChild(botDiv);
  chatBox.scrollTop = chatBox.scrollHeight;

  HISTORY.unshift({q: question, tag: "Incidente", conf: avgScore});
  renderHistory();
  renderFragments(frags);
}

askBtn.addEventListener('click',()=>{
  const q = questionInput.value.trim();
  if(!q) return alert("Escribe tu pregunta.");
  const userDiv = document.createElement('div');
  userDiv.className = "bg-[#004080] p-3 rounded-lg max-w-[75%] ml-auto";
  userDiv.textContent = q;
  chatBox.appendChild(userDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
  questionInput.value = '';
  simulateResponse(q);
});

// Tabs funcionales
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('tab-active'));
    btn.classList.add('tab-active');
    const tab = btn.getAttribute('data-tab');
    document.querySelectorAll('.tab-panel').forEach(p=>p.classList.add('hidden'));
    if(tab==='fragments') document.getElementById('fragments').classList.remove('hidden');
    if(tab==='history') document.getElementById('historyTab').classList.remove('hidden');
    if(tab==='pdfs') document.getElementById('pdfs').classList.remove('hidden');
  });
});
</script>

</body>
</html>
